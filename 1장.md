## 마이크로서비스 아키텍처와 레디스

### NoSQL이란?
+ No SQL, Not Only SQL을 의미
+ 관계형 데이터베이스에서 테이블의 데이터를 쿼리하기 위한 SQL을 사용하지 않는 데이터 저장소임을 내포
    
### NoSQL의 특징
+ 실시간 응답
    - 빠른 읽기/쓰기 성능
+ 확장성
    - 수평적 확장(Scale-out)이 쉬움
+ 고가용성
    - 일부 서버가 다운되어도 슬레이브를 마스터로 승격히켜 운영
+ 클라우드 네이티브
    - 클라우드 환경에 최적화된 설계
+ 단순성
    - 복잡한 조인이나 관계 설정없이 직관적으로 사용(key-value 구조)
    ```
    SET user:1001 "김철수"
    GET user:1001
    ```
+ 유연성
    - 스키마 변경이 자유로움

### NoSQL 데이터 저장소 유형
+ 그래프 유형
    - 노드, 에지, 속성 등으로 데이터를 표현하며 복잡한 관계 분석에 최적화
    ```
    노드:
    - (김철수: Person {age: 30, city: "서울"})
    - (이영희: Person {age: 28, city: "부산"})
    - (삼성전자: Company {industry: "기술"})

    관계:
    - (김철수)-[FRIEND_OF {since: 2020}]->(이영희)
    - (김철수)-[WORKS_FOR {position: "개발자"}]->(삼성전자)
    - (이영희)-[LIVES_IN]->(부산)
    ```

+ 칼럼 유형
    - 행과 열로 구성되지만 각 행마다 다른 열을 가질 수 있는 유연한 구조
    ```
    사용 예시(시계열 데이터)
    Row Key: sensor_001_20250814
    Columns: 
    - 09:00:00 → {temperature: 23.5, humidity: 65}
    - 09:01:00 → {temperature: 23.7, humidity: 64}
    - 09:02:00 → {temperature: 23.6, humidity: 66}

    Row Key: sensor_002_20250814
    Columns:
    - 09:00:00 → {temperature: 22.1, pressure: 1013.2}
    - 09:01:00 → {temperature: 22.3, pressure: 1013.1}
    ```

+ 문서 유형
    - JSON, XML과 같은 문서 형태로 데이터를 저장
    - 관계형 데이터베이스는 평면적인 테이블 구조만 지원하지만 문서형 NoSQL은 문서 내부에 또 다른 문서나 배열을 포함할 수 있다
        - 객체 중첩
        - 배열 중첩

        ```sql
        -- 여러 테이블로 분리 필요
        Users: user_id, name, email
        Addresses: address_id, user_id, street, city
        Phones: phone_id, user_id, type, number
        Orders: order_id, user_id, total
        Order_Items: item_id, order_id, product_id, quantity
        ```

        ```json
        // 하나의 문서에 모든 관련 데이터 포함
        {
            "user_id": "user123",
            "name": "김철수",
            "contact": {
                "email": "kim@example.com",
                "phones": ["010-1234-5678", "02-123-4567"],
                "address": {"street": "강남대로 123", "city": "서울"}
            },
            "orders": [
                {
                    "order_id": "ORD001",
                    "items": [
                        {"product": "노트북", "quantity": 1, "price": 1500000}
                    ]
                }
            ]
        }
        ```
    - 중첩 구조의 장점
        - 자연스러운 데이터 모델링

        ```json
        // 블로그 포스트 예시 - 실제 데이터 구조와 유사
        {
            "post_id": "post123",
            "title": "NoSQL 가이드",
            "content": "NoSQL에 대한 설명...",
            "author": {
                "name": "김개발자",
                "bio": "10년차 개발자"
            },
            "comments": [
                {
                "author": "독자1",
                "text": "좋은 글입니다",
                "replies": [
                    {"author": "김개발자", "text": "감사합니다"}
                ]
                }
            ]
        }
        ```

        - 단일 쿼리로 완전한 데이터 조회
            
        ```
        // MongoDB 예시
        db.posts.findOne({"post_id": "post123"})
        // 포스트, 작성자 정보, 댓글까지 한 번에 가져옴
        ```

        - 스키마 유연성
            
        ```json
        // 사용자마다 다른 구조 가능
        {
            "user_id": "user001",
            "profile": {
                "name": "개인사용자",
                "preferences": {"theme": "dark"}
            }            
        }

        {
            "user_id": "user002", 
            "profile": {
                "company_name": "기업사용자",
                "business_info": {
                    "industry": "IT",
                    "employees": 100
                },
                "billing": {
                    "plan": "enterprise",
                    "payment_method": "invoice"
                }
            }
        }
        ```

+ 키-값 유형
    - 가장 단순한 NoSQL 형태로 고유한 키와 값의 쌍으로 데이터 저장
    - 키는 관계형 데이터베이스의 PK 역할을 한다
    - 사용예시
        - 세션 관리
        - 캐싱
        - 실시간 채팅

### 레디스란?
+ Remote dictionary server의 약자로 고성능 키-값 유형의 인메모리 NoSQL 데이터베이스
+ 오픈소스 기반의 데이터 저장소

### 레디스의 특징
+ 실시간 응답(빠른 성능)
    - 레디스는 인메모리 데이터베이스로 온디스크 데이터베이스보다 빠른 응답속도를 가진다

+ 단순성
    - 레디스는 키-값 형태로 데이터를 관리할 수 있는 데이터 저장소
    - 키에 매핑되는 값에는 문자열부터 hash, set 등 다양한 데이터 구조를 저장할 수 있다
    - 레디스는 싱글 스레드로 동작한다
        - 메인 스레드 1개와 별도의 스레드 3개로 구성되어 있지만 클라이언트의 커맨드는 하나의 스레드에서만 처리한다

+ 고가용성
    - 레디스는 자체적으로 HA(High Availability) 기능을 제공한다
    - 복제를 통해 데이터를 여러 서버에 분산가능하며 센티널은 장애를 탐지해 자동으로 페일오버 처리한다
        - 마스터에서 장애가 발생하더라도 엔드포인트 변경없이 바로 마스터 노드를 사용할 수 있다

+ 확장성
    - 레디스에서 클러스터 모드를 사용한다면 손쉬운 수평적 확장이 가능하다
    - 데이터는 레디스 클러스터에서 자동으로 샤딩된 후 저장되며 여러개의 복제분이 생성될 수 있다
    - 데이터의 분리는 데이터베이스 레이어에서 처리되며 애플리케이션에서는 대상 데이터가 어떤 샤드에 있는지 신경쓸 필요가 없다
    - 클러스터 구조에서 모든 레디스 인스턴스는 클러스터 버스라는 프로토콜을 이용하여 감시하고 있으며 클러스터의 마스터 노드에 문제가 발생하면 자동으로 페일오버하여 고가용성을 유지한다

+ 클라우드 네이티브 - 멀티 클라우드
    - 클라우드 네이티브는 클라우드 환경에 특화된 애플리케이션의 개발 및 운영 방식을 의미
    - 멀티 클라우드는 여러 클라우드 제공업체의 서비스를 혼합해 활용하는 전략을 의미한다